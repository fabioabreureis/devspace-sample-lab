schemaVersion: 2.2.0
metadata:
  name: kubedock-sample-devfile

components:
  - name: tools
    container:
      image: registry.access.redhat.com/ubi8/openjdk-17
      memoryLimit: "2Gi"
      memoryRequest: "1Gi"
      cpuLimit: "1"
      cpuRequest: "200m"
      env:
        - name: KUBEDOCK_PARAMS
          value: "--reverse-proxy --initimage joyrex2001/kubedock:0.20.3"
        - name: USE_JAVA17
          value: "true"
        - name: MAVEN_CONFIG
          value: /home/user/.m2
        - name: MAVEN_OPTS
          value: "-Xmx4G -Xss128M -XX:MetaspaceSize=1G -XX:MaxMetaspaceSize=2G"
        - name: KUBEDOCK_ENABLED
          value: "true"
        - name: DOCKER_HOST
          value: "tcp://127.0.0.1:2475"
        - name: TESTCONTAINERS_RYUK_DISABLED
          value: "true"
        - name: TESTCONTAINERS_CHECKS_DISABLE
          value: "true"

      endpoints:
        - exposure: none
          name: kubedock
          protocol: tcp
          targetPort: 2475
        - exposure: public
          name: http-booster
          protocol: http
          targetPort: 8080
          attributes:
            discoverable: true
            urlRewriteSupported: true
        - exposure: internal
          name: debug
          protocol: http
          targetPort: 5005

      volumeMounts:
        - name: m2
          path: /home/user/.m2

  - name: m2
    volume:
      size: 10G
